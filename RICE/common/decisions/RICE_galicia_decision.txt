
RICE_galicia_alter_saint_james_tomb = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_cathedral.dds"
	major = yes
	desc = RICE_galicia_alter_saint_james_tomb_desc

	ai_check_interval = 120

	is_shown = {
		NOT = { has_global_variable = RICE_galicia_saint_james_tomb_not_found_yet }
		is_landed = yes
		has_title = title:c_santiago
		religion = religion:christianity_religion
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_santiago_altered
			}
		}
	}

	is_valid = {
		has_title = title:c_santiago
		religion = religion:christianity_religion
		piety_level >= 3
		title:c_santiago = {
			faith.religion = religion:christianity_religion
		}
		title:b_santiago.title_province = {
			has_building = holy_site_basilica_santiago_01
		}
		custom_description = {
			text = RICE_has_court_chaplain
			exists = cp:councillor_court_chaplain
			cp:councillor_court_chaplain = {
				is_available_adult = yes
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_available = yes
	}

	cost = {
		gold = {
			value = medium_gold_value
		}
		piety = {
			value = massive_piety_value
		}
	}

	ai_potential = {
		short_term_gold > medium_gold_value
		piety > massive_piety_value
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_santiago_altered
		}

		save_scope_as = diego_gelmirez
		
		custom_tooltip = RICE_galicia_alter_saint_james_tomb_effect_tooltip_1
		custom_tooltip = RICE_galicia_alter_saint_james_tomb_effect_tooltip_2

		show_as_tooltip = {
			RICE_galicia_alter_the_altar_effect = yes
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_galicia_alter_saint_james_tomb_context_tooltip
		}
		
		trigger_event = galicia.0012
	}

	ai_will_do = {
		base = 25
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = craven
		}
		modifier = {
			add = 20
			# Happened in 11th century IRL
			current_date >= 1000.1.1
		}
		modifier = {
			add = 30
			# Happened in 11th century IRL
			current_date >= 1100.1.1
		}
		modifier = {
			add = 40
			# Happened in 11th century IRL
			current_date >= 1150.1.1
		}
	}
}


RICE_galicia_saint_james_routes_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_christian_pilgrimage.dds"
	desc = RICE_galicia_saint_james_routes_decision_desc

	ai_check_interval = 40
	
	cooldown = { days = RICE_galicia_way_of_saint_james_decisions_cooldown_time }

	is_shown = {
		is_landed = yes
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					geographical_region = world_europe_west_iberia
					geographical_region = custom_occitan
				}	
			}
		}
		religion = religion:christianity_religion
	}

	is_valid = {
		custom_description = {
			text = RICE_saint_james_geographical_capital_req
			any_held_title = {
				tier = tier_county
				any_county_province = {
					OR = {
						geographical_region = world_europe_west_iberia
						geographical_region = custom_occitan
					}	
				}
			}
		}
		religion = religion:christianity_religion
		NOR = {
			has_character_modifier = RICE_galicia_way_of_saint_james_supporter
			has_character_modifier = RICE_galicia_way_of_saint_james_robber_baron
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_available = yes
	}

	cost = {
		gold = { value = RICE_saint_james_decision_cost_value }
	}
	
	ai_potential = {
		short_term_gold > RICE_saint_james_decision_cost_value
	}

	effect = {

		show_as_tooltip = {
			add_piety = RICE_saint_james_help_piety_reward_value
		}

		custom_tooltip = RICE_galicia_saint_james_routes_decision_effect_tooltip_1
		custom_tooltip = RICE_galicia_saint_james_routes_decision_effect_tooltip_2

		add_character_modifier = {
			modifier = RICE_galicia_way_of_saint_james_supporter
			years = 10
		}

		show_as_tooltip = {
			random_list = {
				desc = RICE_galicia_saint_james_routes_decision_tt
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_routes_decision_counties.close
					custom_tooltip = RICE_galicia_saint_james_routes_decision_counties.close.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_routes_decision_counties.midrange.high
					custom_tooltip = RICE_galicia_saint_james_routes_decision_counties.midrange.high.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_routes_decision_counties.distant.high
					custom_tooltip = RICE_galicia_saint_james_routes_decision_counties.distant.high.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_routes_decision_counties.midrange.low
					custom_tooltip = RICE_galicia_saint_james_routes_decision_counties.midrange.low.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_routes_decision_counties.distant.low
					custom_tooltip = RICE_galicia_saint_james_routes_decision_counties.distant.low.tooltip
				}
			}
		}
	

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_galicia_saint_james_routes_decision_context_tooltip
		}
		
		trigger_event = {
			id = galicia.0010
		}

	}

	ai_will_do = {
		base = 25
		modifier = {
			add = -10
			has_trait = cynical
		}
		modifier = {
			add = 10
			has_trait = zealous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
		modifier = {
			add = 10
			has_trait = generous
		}
	}
}

RICE_galicia_saint_james_levy_extra_tolls = {
	picture = "gfx/interface/illustrations/decisions/decision_christian_pilgrimage.dds"
	desc = RICE_galicia_saint_james_levy_extra_tolls_desc

	ai_check_interval = 40
	
	cooldown = { days = RICE_galicia_way_of_saint_james_decisions_cooldown_time }

	is_shown = {
		is_landed = yes
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					geographical_region = world_europe_west_iberia
					geographical_region = custom_occitan
				}	
			}
		}
		religion = religion:christianity_religion
	}

	is_valid = {
		custom_description = {
			text = RICE_saint_james_geographical_capital_req
			any_held_title = {
				tier = tier_county
				any_county_province = {
					OR = {
						geographical_region = world_europe_west_iberia
						geographical_region = custom_occitan
					}	
				}
			}
		}
		religion = religion:christianity_religion
		NOR = {
			has_character_modifier = RICE_galicia_way_of_saint_james_supporter
			has_character_modifier = RICE_galicia_way_of_saint_james_robber_baron
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_available = yes
	}

	cost = {
		piety = { value = RICE_saint_james_toll_piety_cost_value }
	}
	
	ai_potential = {
		piety > RICE_saint_james_toll_piety_cost_value
	}

	effect = {

		show_as_tooltip = {
			add_gold = RICE_saint_james_toll_money_reward_value
		}

		custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_effect_tooltip_1


		show_as_tooltip = {

			add_character_modifier = {
				modifier = RICE_galicia_way_of_saint_james_robber_baron
				years = 10
			}

			random_list = {
				desc = RICE_galicia_saint_james_levy_extra_tolls_tt
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_levy_extra_tolls_counties.close
					custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_counties.close.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_levy_extra_tolls_counties.midrange.high
					custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_counties.midrange.high.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_levy_extra_tolls_counties.distant.high
					custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_counties.distant.high.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_levy_extra_tolls_counties.midrange.low
					custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_counties.midrange.low.tooltip
				}
				100 = {
					show_chance = no
					desc = RICE_galicia_saint_james_levy_extra_tolls_counties.distant.low
					custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_counties.distant.low.tooltip
				}
			}
		}
	

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_galicia_saint_james_levy_extra_tolls_context_tooltip
		}
		
		trigger_event = {
			id = galicia.0010
		}

	}

	ai_will_do = {
		base = 20
		modifier = {
			add = -15
			has_trait = zealous
		}
		modifier = {
			add = 15
			has_trait = greedy
		}
		modifier = {
			add = -10
			has_trait = generous
		}
		modifier = {
			add = 10
			has_trait = cynical
		}
		modifier = {
			add = -5
			has_trait = compassionate
		}
		modifier = {
			add = 5
			has_trait = callous
		}
		modifier = {
			add = -5
			has_trait = just
		}
		modifier = {
			add = 5
			has_trait = arbitrary
		}
	}
}




RICE_galicia_cantiga_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_european_musician.dds"

	ai_check_interval = 24

	cooldown = { days = 1825 }
	
	desc = RICE_galicia_cantiga_decision_desc
	
	is_shown = {
		is_ruler = yes
		is_landed = yes
		# OR = {
		# 	culture = { has_cultural_tradition = tradition_RICE_galician_portuguese_poetry }
		# 	capital_province = {
		# 		geographical_region = world_europe_west_iberia
		# 	}
		# }
		culture = {
			OR = {
				has_cultural_tradition = tradition_RICE_galician_portuguese_poetry
				AND = {
					has_cultural_pillar = heritage_iberian
					has_cultural_pillar = language_iberian	
				}
			}
		}	
	}
	
	is_valid = {
		OR = {
			diplomacy >= medium_skill_rating
			learning >= medium_skill_rating
			has_trait = poet
			has_trait = scholar
			has_trait = education_diplomacy_3
			has_trait = education_diplomacy_4
			has_trait = education_learning_3
			has_trait = education_learning_4
		}
		OR = {
			culture = { has_cultural_tradition = tradition_RICE_galician_portuguese_poetry }
			custom_description = {
				text = RICE_iberia_geographical_capital_req
				capital_province = {
					geographical_region = world_europe_west_iberia
				}
			}
		}
		culture = {
			OR = {
				has_cultural_tradition = tradition_RICE_galician_portuguese_poetry
				AND = {
					has_cultural_pillar = heritage_iberian
					has_cultural_pillar = language_iberian	
				}
			}
		}	
		culture = {
			OR = {
				has_cultural_era_or_later = culture_era_high_medieval
				has_innovation = innovation_chronicle_writing
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	# minimum_cost = {
	# 	gold = 100
	# }

    widget = {
    	gui = "decision_view_widget_RICE_galicia_cantiga_decision"
		controller = decision_option_list_controller
    	
		decision_has_second_step = yes
		decision_custom_widget_container = "custom_widgets_container_step_two"
		decision_to_second_step_button = "RICE_galicia_cantiga_pick_a_genre_type" 


		# Courtly Love / Cantigas de Amor
		item = {
			value = RICE_cantiga_courtly_love_option
			current_description = RICE_cantiga_courtly_love_option_desc
			localization = RICE_cantiga_courtly_love_option
			icon = "gfx/interface/icons/event_types/type_duty.dds"

			ai_chance = {
				value = 1
			}
		}

		# Romantic Love / Cantigas de Amigo
		item = {
			value = RICE_cantiga_romantic_love_option
			current_description = RICE_cantiga_romantic_love_option_desc
			localization = RICE_cantiga_romantic_love_option
			icon = "gfx/interface/icons/event_types/type_seduction.dds"

			ai_chance = {
				value = 1
			}
		}

		# Satire / Cantigas de Escarnio e Maldizer
		item = {
			value = RICE_cantiga_satire_option
			current_description = RICE_cantiga_satire_option_desc
			localization = RICE_cantiga_satire_option
			icon = "gfx/interface/icons/event_types/type_relation_friendly.dds"

			ai_chance = {
				value = 1
			}
		}

	}

	effect = {

		custom_tooltip = RICE_galicia_cantiga_decision_effect_tooltip_1
		custom_tooltip = RICE_galicia_cantiga_decision_effect_tooltip_2

		if = {
			limit = {
				culture = { has_cultural_tradition = tradition_RICE_galician_portuguese_poetry }
			}
			custom_tooltip = RICE_galicia_cantiga_decision_effect_tooltip_3
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_galicia_cantiga_decision_context_tooltip
		}

		if = { # Courtly Love / Cantigas de Amor
			limit = { scope:RICE_cantiga_courtly_love_option = yes }
			set_variable = {
				name = RICE_cantiga_type
				value = flag:courtly_love
			}
		}

		else_if = { # Romantic Love / Cantigas de Amigo
			limit = { scope:RICE_cantiga_romantic_love_option = yes }
			set_variable = {
				name = RICE_cantiga_type
				value = flag:romantic_love
			}
		}

		else_if = { # Satire / Cantigas de Escarnio e Maldizer
			limit = { scope:RICE_cantiga_satire_option = yes }
			set_variable = {
				name = RICE_cantiga_type
				value = flag:satire
			}
		}
		
		trigger_event = {
			id = galicia.0020
		}
	}

	cost = {
		gold = { value = minor_gold_value } # Will depend
		prestige = { value = medium_prestige_value } # Will depend
	}

	ai_potential = {
		short_term_gold > minor_gold_value
		prestige > medium_prestige_value
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 20
			has_trait = poet
		}
		modifier = {
			add = 10
			has_trait = scholar
		}
		modifier = {
			add = -25
			has_trait = lazy
		}
	}
}




RICE_galicia_pray_to_santiago = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_cathedral.dds"

	ai_check_interval = 24

	cooldown = { days = 1825 }
	
	desc = RICE_galicia_pray_to_santiago_desc
	
	is_shown = {
		is_ruler = yes
		is_landed = yes
		OR = {
			AND = {
				is_target_in_global_variable_list = {
					name = unavailable_unique_decisions
					target = flag:RICE_santiago_altered
				}				
				capital_province = {
					geographical_region = world_europe_west_iberia
				}
			}			
			capital_province = {
				geographical_region = RICE_galicia_region
			}			
		}
		religion = religion:christianity_religion
	}
	
	is_valid = {
		piety_level >= 2

		# After the altar has been altered
		trigger_if = {
			limit = {
				is_target_in_global_variable_list = {
					name = unavailable_unique_decisions
					target = flag:RICE_santiago_altered
				}
			}
			custom_description = {
				text = RICE_iberia_geographical_capital_req
				capital_province = {
					geographical_region = world_europe_west_iberia
				}
			}
		}
		trigger_else = {		
			custom_description = {
				text = RICE_galicia_geographical_capital_req
				capital_province = {
					geographical_region = RICE_galicia_region
				}
			}
		}


		religion = religion:christianity_religion
		OR = {
			culture = {
				has_cultural_pillar = heritage_iberian
			}	
			custom_description = {
				text = RICE_iberia_struggle_involved_req
				struggle:iberian_struggle = { is_culture_involved_in_struggle = root.culture }
			}
			piety_level >= 4
		}
		custom_description = {
			text = RICE_no_saint_james_modifier_req
			RICE_has_saint_james_modifier_trigger = no
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {

		custom_tooltip = RICE_galicia_pray_to_santiago_effect_tooltip_1
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_galicia_pray_to_santiago_context_tooltip
		}
		
		trigger_event = {
			id = galicia.0011
		}
	}

	cost = {
		gold = { value = minor_gold_value } # Will depend
		piety = { value = RICE_saint_james_prayer_decision_piety_cost_value } # Will depend
	}

	ai_potential = {
		short_term_gold > minor_gold_value
		piety > RICE_saint_james_prayer_decision_piety_cost_value
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 20
			has_trait = poet
		}
		modifier = {
			add = 10
			has_trait = scholar
		}
		modifier = {
			add = -25
			has_trait = lazy
		}
	}
}

