
#############################################
#											#
# STRUGGLE ENDING DECISIONS				    #
#											#
#############################################

# Dominion Ending
RICE_sicily_struggle_ending_dominion_decision = {
	major = yes
	title = RICE_sicily_struggle_ending_dominion_decision
	picture = "gfx/interface/illustrations/decisions/decision_mediterranean_throne_room.dds"
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_mediterranean_throne_room_small.dds"
	desc = RICE_sicily_struggle_ending_dominion_decision_desc
	selection_tooltip = RICE_sicily_struggle_ending_dominion_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		exists = struggle:RICE_sicily_struggle

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
		}

		completely_controls_region = custom_sicily

		dynasty ?= {
			has_dynasty_perk = RICE_sicily_legacy_5
		}

	}

	widget = {
		gui = "decision_view_widget_RICE_sicily_dominion_ending"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_DOMINION_ENDING_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_struggle_ending_dominion_latin
			is_valid = {
				RICE_sicily_latin_trigger = yes
			}
			current_description = RICE_sicily_struggle_ending_dominion_latin_desc
			localization = RICE_sicily_struggle_ending_dominion_latin_name
			icon = "gfx/interface/icons/icon_RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_struggle_ending_dominion_greek
			is_valid = {
				OR = {
					culture = { has_cultural_pillar = heritage_byzantine }
					faith.religious_head_title ?= title:k_orthodox
				}
			}
			current_description = RICE_sicily_struggle_ending_dominion_greek_desc
			localization = RICE_sicily_struggle_ending_dominion_greek_name
			icon = "gfx/interface/icons/icon_RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_struggle_ending_dominion_arabic
			is_valid = {
				RICE_sicily_arabic_trigger = yes
			}
			current_description = RICE_sicily_struggle_ending_dominion_arabic_desc
			localization = RICE_sicily_struggle_ending_dominion_arabic_name
			icon = "gfx/interface/icons/icon_RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### OUTSIDER
		item = {
			value = RICE_sicily_struggle_ending_dominion_outsider
			is_valid = {
				NOT = { RICE_sicily_latin_trigger = yes }
			}
			current_description = RICE_sicily_struggle_ending_dominion_outsider_desc
			localization = RICE_sicily_struggle_ending_dominion_outsider_name
			icon = "gfx/interface/icons/icon_RICE_sicily_default.dds"
			ai_chance = {
				value = 10
			}
		}

	}

	effect = {
		# if = {
		# 	limit = { has_dlc_feature = legends }
		# 	RICE_sri_lanka_legend_seed_struggle_ending_effect = {
		# 		ENDER = root
		# 		STRUGGLE = RICE_sicily_struggle
		# 	}
		# }

		save_scope_as = RICE_sicily_struggle_ender

		##### Major Effects #####		
		RICE_sicily_end_struggle_effect = {
			ENDING = yes
			EVENT = sicily.8888
			FLAG = flag:RICE_sicily_struggle_dominion_ending
		}
		show_as_tooltip = {
			give_nickname = RICE_nick_stupor_mundi
			add_piety = 1000
			add_prestige = 1000
			dynasty = {
				add_dynasty_prestige = 1000
				add_dynasty_modifier = {
					modifier = RICE_sri_lanka_sangha_uniter_modifier
				}
			}
		}
		# Phase doctrine
		custom_tooltip = RICE_sicily_struggle_ending_dominion_modifier_effect_tt
		# Relic effect
		custom_tooltip = RICE_sicily_struggle_ending_dominion_mechanics_effect_tt

		# Trigger the ending event
		trigger_event = sicily.8888
	}

	cost = {}

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}



# Crossroads Ending
RICE_sicily_struggle_ending_crossroads_decision = {
	major = yes
	title = RICE_sicily_struggle_ending_crossroads_decision
	picture = "gfx/interface/illustrations/decisions/decision_middle_eastern_tavern.dds"
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_middle_eastern_tavern_small.dds"
	desc = RICE_sicily_struggle_ending_crossroads_decision_desc
	selection_tooltip = RICE_sicily_struggle_ending_crossroads_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		exists = struggle:RICE_sicily_struggle

		custom_tooltip = {
			text = struggle_ending_decision_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
		}

		completely_controls_region = custom_sicily

		dynasty ?= {
			has_dynasty_perk = RICE_sicily_legacy_5
		}

	}

	effect = {
		# if = {
		# 	limit = { has_dlc_feature = legends }
		# 	RICE_sri_lanka_legend_seed_struggle_ending_effect = {
		# 		ENDER = root
		# 		STRUGGLE = RICE_sicily_struggle
		# 	}
		# }

		save_scope_as = RICE_sicily_struggle_ender


		##### Major Effects #####		
		RICE_sicily_end_struggle_effect = {
			ENDING = yes
			EVENT = sicily.8888
			FLAG = flag:RICE_sicily_struggle_crossroads_ending
		}
		show_as_tooltip = {
			give_nickname = RICE_nick_stupor_mundi
			add_piety = 1000
			add_prestige = 1000
			dynasty = {
				add_dynasty_prestige = 1000
				add_dynasty_modifier = {
					modifier = RICE_sri_lanka_sangha_uniter_modifier
				}
			}
		}
		# Phase doctrine
		custom_tooltip = RICE_sicily_struggle_ending_crossroads_modifier_effect_tt
		# Relic effect
		custom_tooltip = RICE_sicily_struggle_ending_crossroads_mechanics_effect_tt

		# Trigger the ending event
		trigger_event = sicily.8888
	}

	cost = {}

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}


#############################################
#											#
# STRUGGLE START DECISIONS				    #
#											#
#############################################



# Occupy Sicilian Frontier
RICE_sicily_occupy_sicilian_frontier = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds"

	desc = RICE_sicily_occupy_sicilian_frontier_desc
	selection_tooltip = RICE_sicily_occupy_sicilian_frontier_tooltip
	major = yes

	ai_check_interval = 24

	is_shown = {	
		NOT = { exists = struggle:RICE_sicily_struggle }
		exists = dynasty
		highest_held_title_tier > tier_barony
		is_landed = yes
		# Owns territory in Sicily or one of the surrounding regions
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					#geographical_region = custom_sicily		
					geographical_region = world_europe_south
					geographical_region = world_europe_west_iberia
					geographical_region = world_africa_north
				}	
			}
		}
		exists = global_var:RICE_sicily_struggle_ending
		OR = {
			global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
			global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
		}
	}
	
	is_valid = {
		# Capital is NOT in Sicily
		custom_description = {
			text = "RICE_sicily_NOT_capital_req"
			NOT = {
				root.capital_county = {
					title_province = { geographical_region = custom_sicily }
				}
			}
		}		
		# Own at least 4 counties in Sicily
		custom_tooltip = {
			text = RICE_sicily_start_struggle_geographical_req
			any_sub_realm_county = {
				count >= 4
				title_province = { geographical_region = custom_sicily }
			}
		}
		# Own at least 8 counties overall
		sub_realm_size >= 8
		OR = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				prestige_level >= 1
			}
			trigger_else = {
				prestige_level >= 3
			}
			custom_description = {
				text = "is_king_or_emperor"
				highest_held_title_tier >= tier_kingdom
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	effect = {

		save_scope_as = sicily_struggle_restarter

		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_1
		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_2
		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_3

		show_as_tooltip = {
			RICE_sicily_occupy_sicilian_frontier_effect = yes
		}

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_occupy_sicilian_frontier_context_tooltip
		}

		trigger_event = {
			id = sicily.0010
		}

	}

	cost = { 
		gold = medium_gold_value # Will depend
	}	

	ai_potential = {
		gold > medium_gold_value
	}

	ai_will_do = {
		base = 40
		# Culture is not one of the dominant ones?
		# modifier = {
		# 	add = -30
		# 	NOT = { culture = { has_cultural_pillar = heritage_north_germanic } }
		# }
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}

# Revitalize Sicilian Frontier
RICE_sicily_stabilize_sicilian_frontier = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds"

	desc = RICE_sicily_stabilize_sicilian_frontier_desc
	selection_tooltip = RICE_sicily_stabilize_sicilian_frontier_tooltip
	major = yes

	ai_check_interval = 24

	is_shown = {	
		NOT = { exists = struggle:RICE_sicily_struggle }
		exists = dynasty
		highest_held_title_tier > tier_barony
		is_landed = yes
		# Owns territory in Sicily or one of the surrounding regions
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					#geographical_region = custom_sicily		
					geographical_region = world_europe_south
					geographical_region = world_europe_west_iberia
					geographical_region = world_africa_north
				}	
			}
		}
		exists = global_var:RICE_sicily_struggle_ending
		OR = {
			global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
			global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
		}
	}
	
	is_valid = {
		# Capital is NOT in Sicily
		custom_description = {
			text = "RICE_sicily_capital_req"
			root.capital_county = {
				title_province = { geographical_region = custom_sicily }
			}
		}		
		# Own at least 4 counties in Sicily
		custom_tooltip = {
			text = RICE_sicily_start_struggle_geographical_req
			any_sub_realm_county = {
				count >= 4
				title_province = { geographical_region = custom_sicily }
			}
		}
		# Own at least 5 counties overall
		sub_realm_size >= 5
		OR = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				prestige_level >= 1
			}
			trigger_else = {
				prestige_level >= 3
			}
			custom_description = {
				text = "is_king_or_emperor"
				highest_held_title_tier >= tier_kingdom
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	effect = {

		save_scope_as = sicily_struggle_restarter

		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_1
		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_2
		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_3

		show_as_tooltip = {
			RICE_sicily_stabilize_sicilian_frontier_effect = yes
		}

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_context_tooltip
		}

		trigger_event = {
			id = sicily.0011
		}

	}

	cost = { 
		gold = medium_gold_value # Will depend
	}	

	ai_potential = {
		gold > medium_gold_value
	}

	ai_will_do = {
		base = 40
		# Culture is not one of the dominant ones?
		# modifier = {
		# 	add = -30
		# 	NOT = { culture = { has_cultural_pillar = heritage_north_germanic } }
		# }
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}




#############################################
#											#
# MISCELLANEOUS DECISIONS  					#
#											#
#############################################




RICE_sicily_admirals_bridge_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_ck2_castle_tower.dds"
	major = yes
	desc = RICE_sicily_admirals_bridge_decision_desc

	ai_check_interval = 60

	is_shown = {
		is_landed = yes
		has_title = title:c_palermo
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_sicily_admirals_bridge_built
			}
		}
	}

	is_valid = {
		has_title = title:c_palermo
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = {
			value = major_gold_value
		}
		prestige = {
			value = medium_prestige_value
		}
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_sicily_admirals_bridge_built
		}
		
		save_scope_as = admirals_bridge_builder

		show_as_tooltip = {
			RICE_sicily_build_admirals_bridge_effect = yes
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_admirals_bridge_decision_context_tooltip
		}
		
		trigger_event = sicily.0017

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = content
		}
	}
}





RICE_sicily_support_salerno_medical_school = {
	picture = "gfx/interface/illustrations/decisions/decision_ck2_scientific_experiment.dds"
	desc = RICE_sicily_support_salerno_medical_school_desc

	ai_check_interval = 40
	
	cooldown = { days = 3650 }

	is_shown = {
		is_landed = yes
		#has_title = title:c_salerno
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	is_valid = {
		#has_title = title:c_salerno	
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
		title:c_salerno = {
			has_county_modifier = RICE_sicily_salerno_medical_school_modifier
		}	
		# trigger_if = {
		# 	limit = {
		# 		NOT = {
		# 			title:b_salerno.title_province = {
		# 				has_building = RICE_sicily_salerno_medical_school
		# 			}
		# 		}
		# 	}
		# 	title:b_salerno.title_province = {
		# 		has_holding = yes
		# 	}
		# }
		# trigger_else = {
		# 	title:b_salerno.title_province = {
		# 		has_building = RICE_sicily_salerno_medical_school
		# 	}
		# }
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	minimum_cost = {
		gold = minor_gold_value
	}
	
	ai_potential = {
		short_term_gold > minor_gold_value
	}

	effect = {

		show_as_tooltip = {
			RICE_sicily_salerno_medical_school_decision_effect = yes
		}

		custom_tooltip = RICE_sicily_support_salerno_medical_school_effect_tooltip_1
		custom_tooltip = RICE_sicily_support_salerno_medical_school_effect_tooltip_2
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_support_salerno_medical_school_context_tooltip
		}
		
		trigger_event = sicily.0140

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = compassionate
		}
		modifier = {
			add = -10
			has_trait = callous
		}
		modifier = {
			add = 10
			has_trait = generous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
	}
}

# Sortes Virgilianae
RICE_sicily_virgil_divination_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_ck2_carolingian_script_cm.dds"
	desc = RICE_sicily_virgil_divination_decision_desc

	ai_check_interval = 40
	
	cooldown = { days = 3650 }

	is_shown = {
		OR = {
			RICE_is_greco_roman_religion_group_trigger = yes
			AND = {
				root.capital_county = {
					title_province = { geographical_region = custom_roman_full_borders }
				}
				OR = {
					learning >= decent_skill_rating	
					has_trait = scholar
					has_trait = theologian
					has_trait = lifestyle_mystic
				}				
			}
			learning >= decent_skill_rating
			has_character_flag = RICE_sicily_can_do_virgil_divination
		}
	}

	is_valid = {
		OR = {
			RICE_is_greco_roman_religion_group_trigger = yes
			AND = {			
				# Capital is in the former Roman Empire
				custom_description = {
					text = "RICE_old_roman_empire_geographical_req"
					root.capital_county = {
						title_province = { geographical_region = custom_roman_full_borders }
					}
				}
				OR = {
					learning >= decent_skill_rating	
					has_trait = scholar
					has_trait = theologian
					has_trait = lifestyle_mystic
				}
			}
			custom_description = {
				text = "RICE_sicily_virgil_divination_decision_activity_req"
				has_character_flag = RICE_sicily_can_do_virgil_divination
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	minimum_cost = {
		gold = minor_gold_value
	}
	
	ai_potential = {
		short_term_gold > minor_gold_value
	}

	effect = {

		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_1
		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_2
		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_3
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_virgil_divination_decision_context_tooltip
		}
		
		trigger_event = sicily.8888

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = compassionate
		}
		modifier = {
			add = -10
			has_trait = callous
		}
		modifier = {
			add = 10
			has_trait = generous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
	}
}


# Sponsor the Liber pantegni
# RICE_sicily_sponsor_liber_pantegni = {
# 	picture = "gfx/interface/illustrations/decisions/decision_RICE_european_book.dds"

# 	desc = RICE_sicily_sponsor_liber_pantegni_desc
# 	selection_tooltip = RICE_sicily_sponsor_liber_pantegni_tooltip
# 	major = yes

# 	ai_check_interval = 24

# 	is_shown = {
# 		exists = dynasty
# 		highest_held_title_tier > tier_barony
# 		is_landed = yes
# 		NOT = {
# 			is_target_in_global_variable_list = {
# 				name = unavailable_unique_decisions
# 				target = flag:RICE_normandy_commission_normandy_history
# 			}
# 		}
# 		OR = {
# 			AND = {
# 				exists = struggle:RICE_normandy_struggle
# 				OR = {
# 					any_character_struggle = {
# 						involvement = involved
# 						is_struggle_type = RICE_normandy_struggle
# 					}					
# 					any_character_struggle = {
# 						involvement = interloper
# 						is_struggle_type = RICE_normandy_struggle
# 					}
# 				}
# 			}
# 			any_held_title = {
# 				tier = tier_county
# 				any_county_province = {
# 					geographical_region = RICE_normandy_region	
# 				}
# 			}
# 		}
# 		# OR = {
# 		# 	culture = culture:norman
# 		# 	culture = {
# 		# 		any_parent_culture_or_above = {
# 		# 			this = culture:norman
# 		# 		}
# 		# 	}
# 		# 	dynasty = {
# 		# 		has_dynasty_modifier = RICE_normandy_rollo_family_equivalent
# 		# 	}
# 		# }
# 	}
	
# 	is_valid = {
# 		has_title = title:d_normandy
# 		completely_controls = title:d_normandy
# 		OR = {
# 			culture = culture:norman
# 			culture = {
# 				any_parent_culture_or_above = {
# 					this = culture:norman
# 				}
# 			}
# 			dynasty = {
# 				has_dynasty_modifier = RICE_normandy_rollo_family_equivalent
# 			}
# 		}
# 		OR = {
# 			prestige_level >= 4
# 			dynasty = {
# 				dynasty_prestige_level >= 3
# 			}
# 		}
# 		OR = {
# 			custom_tooltip = {
# 				text = RICE_normandy_struggle_assimilation_decision_correct_phase_tt
# 				struggle:RICE_normandy_struggle = {
# 					is_struggle_phase = struggle_RICE_normandy_phase_acculturation
# 				}
# 			}	
# 			AND = {
# 				learning >= medium_skill_rating
# 				prestige_level >= 3
# 			}		
# 		}
# 	}

# 	is_valid_showing_failures_only = {
# 		is_available_adult = yes
# 	}

# 	effect = {		

# 		culture:norman = {
# 			save_scope_as = norman
# 		}

# 		culture:french = {
# 			save_scope_as = french
# 		}

# 		culture:norse = {
# 			save_scope_as = norse
# 		}

# 		#Can only happen once
# 		add_to_global_variable_list = {
# 			name = unavailable_unique_decisions
# 			target = flag:RICE_normandy_commission_normandy_history
# 		}

# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_1
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_2
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_3
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_4
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_5

# 		if = {
# 			limit = {
# 				has_game_rule = RICE_historical_context_on
# 			}
# 			custom_tooltip = RICE_sicily_sponsor_liber_pantegni_context_tooltip
# 		}

# 		trigger_event = {
# 			id = normandy.0110
# 		}

# 	}

# 	cost = { 
# 		gold = medium_gold_value # Will depend
# 	}	

# 	ai_potential = {
# 		gold > medium_gold_value
# 	}

# 	ai_will_do = {
# 		base = 50
# 		modifier = {
# 			add = -5
# 			has_trait = content
# 		}
# 		modifier = {
# 			add = 5
# 			has_trait = ambitious
# 		}
# 		modifier = {
# 			add = -5
# 			has_trait = craven
# 		}
# 		modifier = {
# 			add = 5
# 			has_trait = brave
# 		}
# 		modifier = {
# 			add = 25
# 			# Happened late 900s IRL
# 			current_date >= 950.1.1
# 		}
# 		modifier = {
# 			add = 50
# 			# Happened late 900s IRL
# 			current_date >= 975.1.1
# 		}
# 		modifier = {
# 			add = 75
# 			# Happened late 900s IRL
# 			current_date >= 1000.1.1
# 		}
# 		modifier = {
# 			add = 100
# 			# Happened late 900s IRL
# 			current_date >= 1025.1.1
# 		}
# 		modifier = {
# 			add = 100
# 			# Happened late 900s IRL
# 			current_date >= 1050.1.1
# 		}
# 	}
# }




#############################################
#											#
# MISCELLANEOUS STRUGGLE-RELATED DECISIONS  #
#											#
#############################################



RICE_sicily_bargain_with_stronghold = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds"
	desc = RICE_sicily_bargain_with_stronghold_desc

	ai_check_interval = 40
	
	cooldown = { years = 5 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	is_valid = {

		# culture = {
		# 	has_innovation = innovation_scorpio
		# }
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_RICE_sicily_bargain_with_stronghold"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_STRONGHOLD_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_latin
			is_valid = {				
				any_held_county = {
					has_county_modifier = RICE_sicily_stronghold_latin
				}
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_latin_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_latin_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_greek
			is_valid = {
				any_held_county = {
					has_county_modifier = RICE_sicily_stronghold_greek
				}
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_greek_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_greek_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_arabic
			is_valid = {			
				any_held_county = {
					has_county_modifier = RICE_sicily_stronghold_arabic
				}
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_arabic_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_arabic_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
	}

	minimum_cost = {
		gold = RICE_sicily_stronghold_bargain_min_bottom_value
	}
	
	ai_potential = {
		short_term_gold > RICE_sicily_stronghold_bargain_min_base_value
	}

	effect = {

		add_prestige = medium_prestige_gain

		if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_latin = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_latin_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_latin_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:latin
				days = 1
			}
		}

		else_if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_greek = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_greek_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_greek_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:greek
				days = 1
			}
		}

		else_if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_arabic = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_arabic_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_arabic_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:arabic
				days = 1
			}
		}

		custom_tooltip = RICE_sicily_bargain_with_stronghold_effect_tooltip_1

		trigger_event = sicily.0030


	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
	}
}



RICE_sicily_recruit_soldiers_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_ck2_battle_scene.dds"
	desc = RICE_sicily_recruit_soldiers_decision_desc

	ai_check_interval = 40
	
	cooldown = { years = 10 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	is_valid = {

	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_generic_multichoice_with_effects"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_SOLDIER_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_recruit_soldiers_choose_latin
			is_valid = {
				OR = {
					RICE_sicily_latin_trigger = yes					
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_latin
					}
					# Sicilian signore trait requirement
				}
			}
			current_description = RICE_sicily_recruit_soldiers_choose_latin_desc
			localization = RICE_sicily_recruit_soldiers_choose_latin_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_recruit_soldiers_choose_greek
			is_valid = {
				OR = {
					RICE_sicily_greek_trigger = yes			
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_greek
					}
					# Sicilian signore trait requirement
				}
			}
			current_description = RICE_sicily_recruit_soldiers_choose_greek_desc
			localization = RICE_sicily_recruit_soldiers_choose_greek_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_recruit_soldiers_choose_arabic
			is_valid = {
				OR = {
					RICE_sicily_arabic_trigger = yes			
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_arabic
					}
					# Sicilian signore trait requirement
				}
			}
			current_description = RICE_sicily_recruit_soldiers_choose_arabic_desc
			localization = RICE_sicily_recruit_soldiers_choose_arabic_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
	}

	cost = {
		gold = { value = medium_gold_value }
		prestige = { value = major_prestige_value }
	}
	
	ai_potential = {
		short_term_gold > medium_gold_value
	}

	effect = {

		if = {
			limit = {
				has_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				NOT = { has_character_flag = RICE_sawdan_sicily_soldier_decision_taken }
			}

			add_character_flag = RICE_sawdan_sicily_soldier_decision_taken
			
		}


		#custom_tooltip = RICE_sicily_recruit_soldiers_decision_effect_tooltip_1

		if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_latin = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:latin
				days = 1
			}
			RICE_sicily_recruit_latin_soldiers_effect = yes
		}

		else_if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_greek = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:greek
				days = 1
			}
			RICE_sicily_recruit_greek_soldiers_effect = yes
		}

		else_if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_arabic = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:arabic
				days = 1
			}
			RICE_sicily_recruit_arabic_soldiers_effect = yes
		}

		trigger_event = sicily.0018

	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
	}
}

RICE_sicily_administer_frontier = {
	picture = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds"
	desc = RICE_sicily_administer_frontier_desc

	ai_check_interval = 28
	
	cooldown = { years = 10 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	is_valid = {
		has_trait = RICE_sicilian_ruler
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_RICE_sicily_administer_frontier"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_AGENDA_TYPE"
		show_from_start = yes
		
		### Reform Government Practices
		item = {
			value = RICE_sicily_frontier_agenda_government_practices
			is_valid = {
				diplomacy >= RICE_sicily_frontier_decision_skill_requirement
				OR = {
					is_married = yes
					custom_tooltip = {
						text = COUNCILLOR_MISSING_CHANCELLOR
						exists = cp:councillor_chancellor
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_STEWARD
						exists = cp:councillor_steward
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_COURT_CHAPLAIN
						exists = cp:councillor_court_chaplain
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_government_practices_desc
			localization = RICE_sicily_frontier_agenda_government_practices_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_legal.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Fortify Settlements
		item = {
			value = RICE_sicily_frontier_agenda_settlements
			is_valid = {
				martial >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_settlements_desc
			localization = RICE_sicily_frontier_agenda_settlements_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_building.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Update Records
		item = {
			value = RICE_sicily_frontier_agenda_records
			is_valid = {
				stewardship >= RICE_sicily_frontier_decision_skill_requirement
				OR = {
					is_married = yes
					custom_tooltip = {
						text = COUNCILLOR_MISSING_CHANCELLOR
						exists = cp:councillor_chancellor
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_STEWARD
						exists = cp:councillor_steward
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_COURT_CHAPLAIN
						exists = cp:councillor_court_chaplain
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_records_desc
			localization = RICE_sicily_frontier_agenda_records_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_book.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Promote Officials
		item = {
			value = RICE_sicily_frontier_agenda_officials
			is_valid = {
				intrigue >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_officials_desc
			localization = RICE_sicily_frontier_agenda_officials_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_officials.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Patronize Arts and Sciences
		item = {
			value = RICE_sicily_frontier_agenda_arts_and_sciences
			is_valid = {
				learning >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_arts_and_sciences_desc
			localization = RICE_sicily_frontier_agenda_arts_and_sciences_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_armillary_sphere.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Attract Immigrants
		item = {
			value = RICE_sicily_frontier_agenda_immigrants
			current_description = RICE_sicily_frontier_agenda_immigrants_desc
			localization = RICE_sicily_frontier_agenda_immigrants_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_immigrants.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Improve Caricatori Ports
		item = {
			value = RICE_sicily_frontier_agenda_ports
			is_valid = {
				any_held_county = {
					any_county_province = {
						geographical_region = RICE_insular_sicily
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_ports_desc
			localization = RICE_sicily_frontier_agenda_ports_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_grain.dds"
			ai_chance = {
				value = 10
			}
		}

	}

	cost = {
		gold = { value = medium_gold_value }
	}
	
	ai_potential = {
		short_term_gold > medium_gold_value
	}

	effect = {

		if = {
			limit = {
				has_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				NOT = { has_character_flag = RICE_sawdan_sicily_frontier_decision_taken }
			}

			add_character_flag = RICE_sawdan_sicily_frontier_decision_taken

			# if = {
			# 	limit = {
			# 		NOT = { has_variable = RICE_sawdan_sicily_frontier_decision_count }
			# 	}
			# 	set_variable = {
			# 		name = RICE_sawdan_sicily_frontier_decision_count
			# 		value = 1
			# 	}
			# }
			# else_if = {
			# 	limit = {
			# 		exists = var:RICE_sawdan_sicily_frontier_decision_count
			# 		var:RICE_sawdan_sicily_frontier_decision_count < 3
			# 	}		
			# 	change_variable = {
			# 		name = RICE_sawdan_sicily_frontier_decision_count
			# 		add = 1
			# 	}
			# }

		}

		#custom_tooltip = RICE_sicily_administer_frontier_effect_tooltip_1

		if = {
			limit = { scope:RICE_sicily_frontier_agenda_government_practices = yes }
			show_as_tooltip = {
				RICE_sicily_government_practices_effect = yes
				custom_tooltip = RICE_sicily_agenda_government_practices_effect_1_tt
				custom_tooltip = RICE_sicily_agenda_government_practices_effect_2_tt
			}
			trigger_event = sicily.0104
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_settlements = yes }
			show_as_tooltip = {
				RICE_sicily_agenda_fortified_settlement_effect = yes
				custom_tooltip = RICE_sicily_fortify_settlement_effect_tt_1
				custom_tooltip = RICE_sicily_fortify_settlement_effect_tt_2
			}
			trigger_event = sicily.0105
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_records = yes }
			show_as_tooltip = {
				RICE_sicily_records_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_2
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_3
			}
			trigger_event = sicily.0103
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_officials = yes }
			show_as_tooltip = {
				RICE_sicily_officials_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_officials_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_officials_effect_tt_2
			}
			trigger_event = sicily.0100
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_arts_and_sciences = yes }
			show_as_tooltip = {
				RICE_sicily_sponsor_arts_sciences_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_2
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_3
			}
			trigger_event = sicily.0106
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_immigrants = yes }
			show_as_tooltip = {
				RICE_sicily_attract_immigrants_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_immigrants_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_immigrants_effect_tt_2
			}
			trigger_event = sicily.0109
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_ports = yes }
			show_as_tooltip = {
				RICE_sicily_agenda_port_effect = yes
				custom_tooltip = RICE_sicily_agenda_port_effect_tt
			}
			trigger_event = sicily.0108
		}

	}

	ai_will_do = {
		base = 30
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}

