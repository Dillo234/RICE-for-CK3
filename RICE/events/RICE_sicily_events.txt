###############################################################################
# 
# SICILY
# 
# sicily.0000-sicily.0019			Setup events, history events, miscellaneous events and decisions
# sicily.0020-sicily.0029			Casus Bellis and other warfare related stuff
# sicily.0030-sicily.0049			Sicily Strongholds
# sicily.0050-sicily.0059			Sicily Grain
# sicily.0060-sicily.0089			Starting situation/aspiration events
# sicily.0090-sicily.0099			Baths of Baia
# sicily.0100-sicily.0119			Administer Frontier Decision
# sicily.0120-sicily.0129			Virgil Flavor
# sicily.0130-sicily.0139			Palermo Tomb Visit
# 
###############################################################################

namespace = sicily

######################################################################################
# 
# SETUP EVENTS, HISTORY EVENTS, MISC DECISIONS
# 
# sicily.0000-sicily.0019
# 
######################################################################################



# SICILY STRUGGLE INTRO 
sicily.0001 = { # Fullscreen Intro Event
	type = character_event
	window = fullscreen_event
	title = sicily.0001.t
	desc = {
		desc = sicily.0001.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					any_character_struggle = {
						involvement = involved
						is_struggle_type = RICE_sicily_struggle
					}
				}
				desc = sicily.0001.desc.involved
			}
			triggered_desc = {
				trigger = {
					any_character_struggle = {
						involvement = interloper
						is_struggle_type = RICE_sicily_struggle
					}
				}
				desc = sicily.0001.desc.interloper
			}
			desc = sicily.0001.desc.uninvolved # Fallback option
		}
	}
	theme = diplomacy_foreign_affairs_focus
	trigger = { # we need to prevent this from firing for all players when a new player joins in MP
		is_ai = no
		NOT = { has_character_flag = RICE_sicily_struggle_intro_event_flag }
		OR = {
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
			any_character_struggle = {
				involvement = interloper
				is_struggle_type = RICE_sicily_struggle
			}
		}
 	}
	override_background = { reference = RICE_sicily_struggle_start }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	widgets = {
		widget = {
 			gui = "event_window_widget_struggle_info"
 			container = "dynamic_content_widget"
 			controller = struggle_info
 			setup_scope = { struggle:RICE_sicily_struggle = { save_scope_as = struggle } }
		}
	}
	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		add_character_flag = RICE_sicily_struggle_intro_event_flag
		add_to_global_variable_list = { # List is only checked for removal, comparing it in the trigger would be needlessly expensive
			name = RICE_sicily_struggle_intro_flag_character_list
			target = root
		}
		save_scope_value_as = {
			name = start
			value = yes
		}
	}

	option = {
		name = sicily.0001.a
		play_music_cue = "mx_spirit_of_the_mediterranean"
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}

}


# Give the yearly resources since it doesn't work in effects for some reason
sicily.0002 = {
	type = character_event
	hidden = yes

	immediate = {

		send_interface_message = {
			type = sicily_struggle_event
			title = RICE_sicily_dominance_notification.title
			custom_description_no_bullet = {
				text = RICE_sicily_dominance_notification.tooltip
			}
		}

	}
}



# Restart Sicilian Struggle (Occupation)
sicily.0010 = {
	type = character_event
	title = sicily.0010.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
				}
				desc = sicily.0010.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
				}
				desc = sicily.0010.desc.imperial
			}		
		}
		desc = sicily.0010.desc
		desc = sicily.0010.desc.conclusion
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_travel }

	right_portrait = {
		character = scope:sicily_struggle_restarter
		animation = war_attacker
	}

	# Ok
	option = {
		name = sicily.0010.a
	}

	after = {
		if = {
			limit = {
				root = scope:sicily_struggle_restarter
			}
			trigger_event = {
				id = sicily.0012
				days = 1
			}
		}
	}

}


# Restart Sicilian Struggle (Revitalizer)
sicily.0011 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
				}
				desc = sicily.0011.t.periphery
			}		
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
				}
				desc = sicily.0011.t.imperial
			}	
			desc = sicily.0011.t # Backup	
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
				}
				desc = sicily.0010.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
				}
				desc = sicily.0010.desc.imperial
			}		
		}
		desc = sicily.0011.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_periphery_ending
				}
				desc = sicily.0011.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					global_var:RICE_sicily_struggle_ending = flag:RICE_sicily_struggle_imperial_ending
				}
				desc = sicily.0011.desc.imperial
			}		
		}
		desc = sicily.0010.desc.conclusion
	}
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_background_sicily_travel }

	right_portrait = {
		character = scope:sicily_struggle_restarter
		animation = war_attacker
	}

	# Ok
	option = {
		name = sicily.0011.a
	}

	after = {
		if = {
			limit = {
				root = scope:sicily_struggle_restarter
			}
			trigger_event = sicily.0012
		}
	}

}

sicily.0012 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				has_global_variable = RICE_sicily_struggle_ending
			}
			remove_global_variable = RICE_sicily_struggle_ending
		}
		start_struggle = {
			struggle_type = RICE_sicily_struggle
			start_phase = struggle_RICE_sicily_phase_borderland
		}
	}
}

#Gain negative stronghold effects
sicily.0015 = {
	hidden = yes

	trigger = {
		#Holder still needs to be the same
		scope:county.holder = scope:holder
	}

	immediate = {
		struggle:RICE_sicily_struggle ?= {
			activate_struggle_catalyst = {
				catalyst = catalyst_RICE_sicily_stronghold_raid
				character = scope:county.holder
			}
		}
		random_list = {
			10 = {
				scope:county.holder = {
					send_interface_message = {
						type = sicily_struggle_event_bad
						title = sicily.0015.message
						left_icon = scope:county
						scope:county = {
							change_county_control = major_county_control_loss
						}
					}
				}
			}
			10 = {
				scope:county.holder = {
					send_interface_message = {
						type = sicily_struggle_event_bad
						title = sicily.0015.message_consolidation_names
						left_icon = scope:county
						scope:county = {
							change_development_progress = minor_development_progress_loss
						}
					}
				}
			}
		}
	}
}


# Siculo-Arabic culture event
sicily.0016 = {
	type = character_event
	title = sicily.0016.t
	desc = sicily.0016.desc
	theme = culture_change
	override_background = { reference = RICE_background_sicily_travel }

	left_portrait = root
	
	trigger = {
		# Not Sicilian
		culture = {
			NOR = {
				this = culture:sicilian
				any_parent_culture_or_above = {
					this = culture:sicilian
				}
			}
		}
		RICE_sicily_arabic_trigger = yes
		any_held_title = {
			tier = tier_county
			exists = holder
			NOT = { exists = var:RICE_had_siculo_arabic_county_conversion }
			title_province = {
				geographical_region = custom_sicily
			}
			culture = {
				NOR = {
					this = culture:sicilian
					any_parent_culture_or_above = {
						this = culture:sicilian
					}
				}
				NOR = {
					this = culture:siculo_arabic
					any_parent_culture_or_above = {
						this = culture:siculo_arabic
					}
				}
			}
			OR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}
		}		
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 2
			culture = culture:norman
		}
	}

	immediate = {
		random_held_title = {
			limit = {
				tier = tier_county
				exists = holder
				NOT = { exists = var:RICE_had_siculo_arabic_county_conversion }
				title_province = {
					geographical_region = custom_sicily
				}
				culture = {
					NOR = {
						this = culture:sicilian
						any_parent_culture_or_above = {
							this = culture:sicilian
						}
					}
					NOR = {
						this = culture:siculo_arabic
						any_parent_culture_or_above = {
							this = culture:siculo_arabic
						}
					}
				}
				OR = {
					RICE_sicily_latin_trigger = yes
					RICE_sicily_greek_trigger = yes
					RICE_sicily_arabic_trigger = yes
				}
			}
			weight = { # Try to approximate organic spread
				base = 1
				modifier = {
					add = 4
					any_neighboring_county = {
						culture = culture:siqilli
					}
				}
			}
			save_scope_as = county_to_change
			culture = {
				save_scope_as = old_culture
			}
			set_variable = {
				name = RICE_had_siculo_arabic_county_conversion
				value = yes
			}
			# Necessary to prevent Sicilian from arising here later on
			set_variable = {
				name = had_sicilian_county_conversion
				value = yes
			}
		}
		culture:siqilli = {
			save_scope_as = siculo_arabic # For loc
		}
		debug_log = "Converted a province to Siculo-Arabic from sicily.0016"
	}

	option = {
		name = sicily.0016.a
		scope:county_to_change = {
			set_county_culture = culture:siqilli
		}
	}
}


# Admiral Bridge's decision event
sicily.0017 = {
	type = character_event
	title = sicily.0017.t
	desc = sicily.0017.desc
	theme = RICE_theme_sicily_village

	left_portrait = root


	immediate = {
		RICE_sicily_build_admirals_bridge_effect = yes
	}

	option = {
		name = sicily.0017.a
	}
}

# Sicily recruit soldier decision
sicily.0018 = {
	type = character_event
	title = sicily.0018.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:latin
				}
				desc = sicily.0018.desc.latin
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:greek
				}
				desc = sicily.0018.desc.greek
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:arabic
				}
				desc = sicily.0018.desc.arabic
			}
			desc = sicily.0018.desc.none # Fallback option
		}
		desc = sicily.0018.desc
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_interior }

	right_portrait = {
		character = root
		animation = war_defender
	}

	immediate = {
		# Save a potential county for the stronghold to appear in
		if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:latin
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_latin }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_latin }
				}
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:greek
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_greek }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_greek }
				}
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:arabic
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_arabic }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_arabic }
				}
				save_scope_as = county
			}
		}
	}

	option = {
		name = sicily.0018.a
		if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:latin }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:latin
				days = 1
			}
			RICE_sicily_recruit_latin_soldiers_effect = yes
		}

		else_if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:greek }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:greek
				days = 1
			}
			RICE_sicily_recruit_greek_soldiers_effect = yes
		}

		else_if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:arabic }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:arabic
				days = 1
			}
			RICE_sicily_recruit_arabic_soldiers_effect = yes
		}
	}

	after = {

		hidden_effect = {
			if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:latin
				}
				random = {
					chance = RICE_sicily_latin_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.latin_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_latin
							}
						}
					}	
				}
			}
			else_if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:greek
				}
				random = {
					chance = RICE_sicily_greek_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.greek_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_greek
							}
						}
					}
				}	
			}
			else_if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:arabic
				}
				random = {
					chance = RICE_sicily_arabic_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.arabic_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_arabic
							}
						}
					}
				}	
			}
		}

		if = {
			limit = {
				has_variable = RICE_sicily_soldier_type
			}
			remove_variable = RICE_sicily_soldier_type
		}

	}

}


######################################################################################
# 
# CASUS BELLI & WARFARE EVENTS
# 
# sicily.0020-sicily.0029
# 
######################################################################################

sicily.0020 = {
	hidden = yes

	immediate = {
		random_character_war = { # We need to locate the war we just created, since we can't save it on creation
			limit = {
				using_cb = RICE_sicily_intervention_cb
				primary_attacker = scope:secondary_recipient # root
				primary_defender = scope:recipient
			}
			add_attacker = scope:actor
		}
	}
}

sicily.0021 = {
	hidden = yes

	immediate = {
		random_character_war = { # We need to locate the war we just created, since we can't save it on creation
			limit = {
				using_cb = RICE_sicily_intervention_cb
				primary_attacker = scope:secondary_recipient # root
				primary_defender = scope:recipient
			}
			save_scope_as = sicilian_intervention_war
		}
		spawn_army = {
			men_at_arms = {
				type = bowmen
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			men_at_arms = {
				type = pikemen_unit
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			men_at_arms = {
				type = light_horsemen
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			levies = fp3_request_invasion_troop_value_bonus_levy_troops
			location = capital_province
			uses_supply = yes
			war = scope:sicilian_intervention_war
			inheritable = no
			name = RICE_sicily_intervention_event_troops
		}
	}
}





######################################################################################
# 
# SICILY STRONGHOLDS
# 
# sicily.0030-sicily.0049
# 
######################################################################################

# add_faction_discontent

# Latin Stronghold rebels
# sicily.0030 = {
# 	type = letter_event
# 	sender = scope:RICE_sicily_leader
# 	opening = "FACTION_DEMAND_RICE_sicily_latin_stronghold"
# 	desc = {
# 		first_valid = {
# 			triggered_desc = {
# 				trigger = {
# 					NOT = {
# 						religion = religion:christianity_religion
# 					}
# 				}
# 				desc = FACTION_DEMAND_RICE_sicily_latin_stronghold_desc_infidel
# 			}		
# 			desc = FACTION_DEMAND_RICE_sicily_latin_stronghold_desc_non_infidel
# 		}
# 	}

# 	trigger = {
# 		exists = scope:faction
# 		exists = scope:RICE_sicily_leader
# 		scope:RICE_sicily_leader.joined_faction = scope:faction
# 	}

# 	on_trigger_fail = {
# 		debug_log = "Latin Stronghold Faction tried to press claim (probably) without existing RICE_sicily_leader"
# 		debug_log_scopes = yes
# 		debug_log = "Latin Stronghold Faction error reporting complete"
# 	}

# 	option = {
# 		name = "FACTION_DEMAND_RICE_sicily_latin_stronghold_ACCEPT"

# 		# LEGITIMACY LOSS FOR ACCEPTING FACTION DEMANDS
# 		faction_accept_demand_legitimacy_effect = yes

# 		peasant_faction_demands_enforced = {FACTION = scope:faction}

# 		ai_chance = {
# 			base = 0
# 			ai_value_modifier = {
# 				ai_boldness = -4
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 100 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 110 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 120 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 130 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 140 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power >= 150 }
# 			}
# 			modifier = {
# 				add = -50
# 				scope:faction.faction_target = {
# 					is_at_war = no
# 					primary_title.tier >= tier_kingdom
# 				}
# 			}
# 			modifier = {
# 				add = -150
# 				scope:faction.faction_target = {
# 					is_at_war = no
# 					primary_title.tier >= tier_empire
# 				}
# 			}
# 		}
# 	}

# 	option = {
# 		name = "FACTION_DEMAND_RICE_sicily_latin_stronghold_REFUSE"

# 		scope:faction = {
# 			faction_start_war = {}
			
# 			# This needs to run after 'faction_start_war' or the troops won't spawn correctly.
# 			faction_spawn_member_county_armies_effect = {
# 				FACTION = scope:faction
# 				ARMY_OWNER = scope:RICE_sicily_leader
# 				PEASANT_ARMY_NAME = peasant_faction_event_troops
# 			}	
# 		}

# 		ai_chance = {
# 			base = 100
# 			ai_value_modifier = {
# 				ai_boldness = 4
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power < 90 }
# 			}
# 			modifier = {
# 				add = 50
# 				scope:faction = { faction_power < 80 }
# 			}
# 			modifier = {
# 				add = 50
# 				NOT = {
# 					religion = religion:christianity_religion
# 				}
# 			}
# 		}
# 	}
# }



# Arab-Berber Stronghold Faction Demand
# Based on vanilla's populist faction
sicily.0034 = {
	type = letter_event
	sender = scope:peasant_leader
	opening = {
		desc = "FACTION_DEMAND_POPULIST"
	}
	desc = "FACTION_DEMAND_POPULIST_DESC"

	trigger = {
		exists = scope:faction
		exists = scope:peasant_leader
		scope:peasant_leader.joined_faction = scope:faction
	}

	on_trigger_fail = {
		debug_log = "Popular Faction tried to press claim (probably) without existing peasant_leader"
		debug_log_scopes = yes
		debug_log = "Popular Faction error reporting complete"
	}

	immediate = {
		every_realm_province = {
			county = { add_to_list = remaining_counties_list }
		}
		scope:faction = {
			every_faction_county_member = { remove_from_list = remaining_counties_list }
		}
	}

	# Option A: Grant the faction independence.
	option = {
		name = "FACTION_DEMAND_POPULIST_ACCEPT_GRANT_INDEPENDENCE"
		trigger = { # AI should not give the faction independence if a player is targeted by the faction.
			NAND = {
				scope:faction = {
					has_variable = faction_targets_player
				}
				is_ai = yes
			}
		}

		# This effect should always be placed here, _before_ all the other effects in the block.
		trigger_event = { on_action = on_faction_demand_accepted }
		
		add_prestige_level = -1
		if = {
			limit = {
				dread > 0
			}
			add_dread = medium_dread_loss
		}

		successful_popular_revolt_outcome_effect = {
			FACTION_LEADER = scope:peasant_leader
			TARGET_TITLE = scope:target_title
			SOURCE_GOVERNMENT = root
		}

		# If the faction includes ALL of our counties, notify the player that it will leave them landless!
		if = {
			limit = {
				any_in_list = {
					list = remaining_counties_list
					count < 1
				}
			}
			custom_tooltip = FACTION_DEMAND_POPULIST_ACCEPT_GRANT_INDEPENCE_TT
		}

		# Struggle Catalysts.
		# Should rename the Catalysts?
		# if = {
		# 	limit = {
		# 		is_important_or_vip_struggle_character = yes
		# 		any_character_struggle = {
		# 			involvement = involved
		# 			activate_struggle_catalyst_secondary_character_involvement_either_trigger = {
		# 				CATALYST = catalyst_accepted_demand_from_faction_requesting_culture_faith_conversion
		# 				CHAR = scope:faction_leader
		# 			}
		# 		}
		# 	}
		# 	every_character_struggle = {
		# 		involvement = involved
		# 		limit = {
		# 			activate_struggle_catalyst_secondary_character_involvement_either_trigger = {
		# 				CATALYST = catalyst_accepted_demand_from_faction_requesting_culture_faith_conversion
		# 				CHAR = scope:faction_leader
		# 			}
		# 		}
		# 		activate_struggle_catalyst = {
		# 			catalyst = catalyst_accepted_demand_from_faction_requesting_culture_faith_conversion
		# 			character = root
		# 		}
		# 	}
		# }

		hidden_effect = {
			if = {
				limit = {
					exists = scope:faction
				}
				scope:faction = {
					clean_revolt_county_modifiers_from_faction_members_effect = yes
					destroy_faction = yes
				}
			}
		}

		ai_chance = {
			base = 0
			compare_modifier = { # Stronger factions increase the chance of an AI ruler capitulating; at 200% ruler army strength, this maxes out at +50% chance to accept demands.
				value = {
					value = scope:faction.faction_power
					subtract = 100
					multiply = 0.5
				}
				max = 50
			}
			compare_modifier = { # Craven rulers can get up to +37% chance to accept demands.
				value = ai_boldness
				multiplier = -0.5
			}
			modifier = {
				factor = 0.1
				any_ally = {
					NOR = {
						target_is_liege_or_above = root
						target_is_vassal_or_below = root
					}
					max_military_strength > root.max_military_strength
				}
			}
			compare_modifier = {
				value = debt_level
				multiplier = 25
			}
			modifier = {
				add = -50
				is_at_war = no
				primary_title.tier >= tier_kingdom
			}
			modifier = {
				add = -150
				is_at_war = no
				primary_title.tier >= tier_empire
			}
			
			modifier = {
				add = -5000
				OR = {
					has_title = title:e_mongol_empire
					has_title = title:e_ilkhanate
					has_title = title:e_chagatai
					has_title = title:e_black_horde
					has_title = title:e_white_horde
					has_title = title:e_aarlud_khanate
					has_title = title:e_togskol_khanate
					has_title = title:e_baruun_khanate
				}
			}
		}
	}
	
	# Option B: Refuse the demand and start a war.
	option = {
		name = "FACTION_DEMAND_POPULIST_REFUSE"

		# This effect should always be placed here, _before_ all the other effects in the block.
		trigger_event = { on_action = on_faction_demand_rejected }

		scope:faction = {
			faction_start_war = {
				title = scope:target_title
			}
		}
		
		custom_tooltip = FACTION_DEMAND_POPULIST_REFUSE_TT
		
		if = { # Send follow up event to affected vassals.
			limit = {
				list_size = {
					name = popular_faction_vassal_targets
					value > 0
				}
			}
			every_in_list = {
				list = popular_faction_vassal_targets
				trigger_event = sicily.0035
			}
		}

		ai_chance = {
			base = 100
			compare_modifier = { # Weaker factions increase the chance of an AI ruler refusing; at 80% army strength (minimum), this will be +20; at 200% army strength, this will max out at -50.
				value = {			
					value = scope:faction.faction_power
					subtract = 100
					multiply = -1
				}
				min = -50
			}
			compare_modifier = { # Brave rulers get up to a 50% bonus chance to refuse.
				value = ai_boldness
				multiplier = -0.5
				min = -50
			}
			modifier = {
				factor = 1.5
				any_ally = {
					NOR = {
						target_is_liege_or_above = root
						target_is_vassal_or_below = root
					}
					max_military_strength > root.max_military_strength
				}
			}
			compare_modifier = {
				value = debt_level
				multiplier = -25
			}
			modifier = {
				add = 5000
				OR = {
					has_title = title:e_mongol_empire
					has_title = title:e_ilkhanate
					has_title = title:e_chagatai
					has_title = title:e_black_horde
					has_title = title:e_white_horde
					has_title = title:e_aarlud_khanate
					has_title = title:e_togskol_khanate
					has_title = title:e_baruun_khanate
				}
			}
		}
	}
	
	after = {
		if = {
			limit = {
				exists = scope:faction
				scope:faction = {
					has_variable = faction_targets_player
				}
			}
			scope:faction = {
				remove_variable = faction_targets_player
			}
		}
	}
}

# Arab-Berber Stronghold Faction Demand - Affected vassals choose their action
sicily.0035 = {
	type = letter_event
	sender = scope:peasant_leader
	opening = {
		desc = "FACTION_DEMAND_POPULIST"
	}
	desc = "FACTION_DEMAND_POPULIST_VASSAL_DESC"

	trigger = {
		exists = scope:faction
		exists = scope:peasant_leader
		scope:peasant_leader.joined_faction = scope:faction
	}
	
	immediate = {
		scope:faction.faction_war = {
			save_scope_as = populist_war
		}
	}
	
	# Option A: Join the rebels if you are Arab-Berber or Muslim already
	option = {
		trigger = {
			RICE_sicily_arabic_trigger = yes
			# You cannot join the attacking side if you already are at war with another participant.
			scope:faction.faction_war = {
				NOT = {
					any_war_participant = {
						is_at_war_with = root
					}
				}
			}
			
			# You cannot join the attacking side if it would put you against someone you are fighting another war with.
			scope:faction.faction_war = {
				NOT = {
					any_war_defender = {
						any_war_ally = {
							this = root
						}
					}
				}
			}
		}
		name = "FACTION_DEMAND_POPULIST_VASSAL_JOIN_REBELS"

		
		# Change culture/faith and apply penalties if needed.
		if = {
			limit = {
				NOT = { culture = scope:peasant_leader.culture }
			}
			set_culture = scope:peasant_leader.culture
			add_prestige_level = -1
		}
		if = {
			limit = {
				NOT = { faith = scope:peasant_leader.faith }
			}
			set_character_faith = scope:peasant_leader.faith
			add_piety_level = -1
		}
		
		# Join the war.
		scope:faction.faction_war = {
			add_attacker = root
		}
		custom_tooltip = FACTION_DEMAND_POPULIST_VASSAL_CONVERTS_TT
		
		stress_impact = {
			content = medium_stress_gain
			craven = medium_stress_gain
			lazy = minor_stress_gain
		}
		
		ai_chance = {
			base = 0
			
			# Want to convert for cultural reasons
			modifier = {
				add = 20
				OR = {
					culture = { has_cultural_pillar = heritage_berber }
					culture = { has_cultural_pillar = heritage_arabic }
				}
			}
			modifier = {
				factor = 2
				struggle:RICE_sicily_struggle ?= {
					is_struggle_phase = struggle_RICE_sicily_phase_borderland
				}
			}
			modifier = {
				factor = 2
				has_trait = zealous
				OR = {
					religion = religion:islam_religion
					religion = religion:amazigh_religion
					religion = religion:semitic_religion
				}
			}
			
			# General modifiers
			modifier = {
				factor = 1.25
				has_trait = fickle
			}
		}
	}
	
	# Option B: Fight alongside your liege.
	option = {
		name = FACTION_DEMAND_POPULIST_VASSAL_JOIN_WAR
		
		# You cannot join the defending side...
		trigger = {
			custom_tooltip = { # ... If you already are at war with another participant.
				text = FACTION_DEMAND_POPULIST_VASSAL_JOIN_WAR_BLOCK_TT
				scope:faction.faction_war = {
					NOT = {
						any_war_participant = {
							is_at_war_with = root
						}
					}
				}
			}
			custom_tooltip = { # ... If it would put you against someone you are fighting another war with.
				text = FACTION_DEMAND_POPULIST_VASSAL_JOIN_WAR_BLOCK_TT_2
				scope:faction.faction_war = {
					NOT = {
						any_war_attacker = {
							any_war_ally = {
								this = root
							}
						}
					}
				}
			}
		}
		show_as_unavailable = {
			OR = {
				scope:faction.faction_war = {
					any_war_participant = {
						is_at_war_with = root
					}
				}
				scope:faction.faction_war = {
					any_war_attacker = {
						any_war_ally = {
							this = root
						}
					}
				}
			}
		}
		
		# Join the war.
		scope:faction.faction_war = {
			add_defender = root
		}
		custom_tooltip = FACTION_DEMAND_POPULIST_VASSAL_JOIN_WAR_TT
		
		ai_chance = {
			base = 100
		}
	}
	
	# Option C: Do nothing.
	option = {
		name = FACTION_DEMAND_POPULIST_VASSAL_TAKE_NO_SIDE
		custom_tooltip = FACTION_DEMAND_POPULIST_VASSAL_TAKE_NO_SIDE_TT_A
		custom_tooltip = FACTION_DEMAND_POPULIST_VASSAL_TAKE_NO_SIDE_TT_B
		
		ai_chance = {
			base = 0
			
			modifier = {
				add = 20
				has_trait = craven
			}
		}
	}
}


######################################################################################
# 
# SICILY STRONGHOLDS
# 
# sicily.0050-sicily.0059
# 
######################################################################################


# Give Sicilian grain shipments
sicily.0050 = {
	type = character_event
	title = sicily.0050.t
	desc = sicily.0050.desc
	theme = RICE_theme_sicily_countryside
	
	left_portrait = scope:actor
	right_portrait = scope:recipient
	
	immediate = {
		show_as_tooltip = {
			remove_short_term_gold = minor_gold_value
			add_prestige = medium_prestige_value
		}		
	}

	option = { # OK
		name = sicily.0050.a
		scope:recipient = {
			show_as_tooltip = {
				RICE_sicily_recipient_gets_wheat_shipments_effect = yes				
			}
			trigger_event = sicily.0051
		}
	}
}



# Gift target receives Sicilian grain shipments
sicily.0051 = {
	type = letter_event
	opening = {
		desc = sicily.0051.opening
	}
	desc = sicily.0051.desc
	
	sender = scope:actor


	option = {
		name = sicily.0051.a
		scope:actor = {
			show_as_tooltip = {
				remove_short_term_gold = minor_gold_value
				add_prestige = medium_prestige_value
			}
		}
		scope:recipient = {		
			RICE_sicily_recipient_gets_wheat_shipments_effect = yes	
			custom_tooltip = RICE_sicily_give_wheat_shipments_positive_effects_tt
			custom_tooltip = RICE_sicily_give_wheat_shipments_negative_effects_tt
		}
	}
}



# Gift target refuses Sicilian grain shipments
sicily.0052 = {
	type = letter_event
	opening = {
		desc = sicily.0052.opening
	}
	desc = sicily.0052.desc
	
	sender = scope:recipient

	option = {
		name = sicily.0052.a
		scope:actor = {
			add_prestige = -50
		}
		scope:recipient = {			
			custom_tooltip = RICE_sicily_give_wheat_shipments_reject_effects_1_tt
			custom_tooltip = RICE_sicily_give_wheat_shipments_reject_effects_2_tt
			reverse_add_opinion = {
				target = scope:actor
				modifier = rejected_opinion
			}
		}
	}
}


# Requestee refuses to give Sicilian grain shipments
sicily.0055 = {
	type = letter_event
	opening = {
		desc = sicily.0055.opening
	}
	desc = sicily.0055.desc
	
	sender = scope:recipient

	option = {
		name = sicily.0055.a
		scope:actor = {
			add_prestige = -50
			add_opinion = {
				target = scope:recipient
				modifier = rejected_opinion
			}
		}
		scope:recipient = {		
			custom_tooltip = RICE_sicily_request_wheat_shipments_reject_effects_1_tt
		}
	}
}




######################################################################################
# 
# STARTING SITUATION/ASPIRATION EVENTS
# 
# sicily.0060-sicily.0089
# 
######################################################################################



# Benavert and other Sicilian Muslim leaders in 1066 Intro Event
sicily.0060 = {
	type = character_event
	title = sicily.0060.t
	desc = sicily.0060.desc
	theme = martial
	override_background = { reference = RICE_background_sicily_ancient_temple }

	left_portrait = {
		character = scope:roger
		animation = war_over_win
	}
	right_portrait = {
		character = scope:benavert
		animation = marshal
	}

	lower_right_portrait = scope:palermo
	lower_center_portrait = scope:agrigento
	lower_left_portrait = scope:malta

	immediate = {

		culture:norman = {
			save_scope_as = norman
		}

		culture:lombard = {
			save_scope_as = lombard
		}

		culture:greek = {
			save_scope_as = greek
		}

		character:maghrebi0011 = { # ibn al-Thumna
			save_scope_as = al_thumna
		}		

		character:159193 = { # Hassan as-Samson, last Kalbid Emir
			save_scope_as = kalbid
		}		

		character:20829 = { # Benavert
			save_scope_as = benavert
		}		

		character:1132 = { # roger I of Sicily
			save_scope_as = roger
		}		

		character:1128 = { # Robert of Sicily
			save_scope_as = robert
		}		

		title:c_palermo.holder = { # palermo
			save_scope_as = palermo
		}		

		title:c_agrigento.holder = { # agrigento
			save_scope_as = agrigento
		}		

		title:c_malta.holder = { # Palermo
			save_scope_as = malta
		}	
		
		title:c_siracusa.holder = {
			save_scope_as = syracuse
		}

		show_as_tooltip = {	
			scope:benavert = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:palermo = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:agrigento = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:malta = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:roger = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_complete_conquest_of_sicily
				}
			}
		}
		# In case we have a custom Muslim ruler
		if = {
			limit = {
				has_title = c_siracusa
				religion = religion:islam_religion
				NOT = { has_character_modifier = RICE_sicily_aspiration_reunify_sicily }
			}
			add_character_modifier = {
				modifier = RICE_sicily_aspiration_reunify_sicily
			}
		}
	}

	# Ok
	option = {
		name = sicily.0060.a
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_description_no_bullet = {
				text = sicily.0060.tooltip
			}
		}
	}
}




# Abu Aaron prepares to leave, ping event
sicily.0070 = {
	type = character_event
	hidden = yes

	trigger = {
		NOT = { has_global_variable = RICE_sicily_abu_aaron_event_happened }
	}

	immediate = {

		# If Abu Aaron isn't in a ruler's court that's not in Babylon, trigger the event again at a later time
		if = {
			limit = {
				OR = {
					is_ruler = yes
					is_foreign_court_or_pool_guest = yes
					employer ?= {
						OR = {
							is_landed = no
							any_held_title = {
								tier = tier_county
								any_county_province = {
									geographical_region = ghw_region_near_east
								}
							}
							highest_held_title_tier = tier_barony
						}
					}
				}
			}

			trigger_event = {
				id = sicily.0070
				years = { 3 8 }
			}

		}

		# If Abu Aaron is in a qualifying court
		else_if = {
			limit = {
				employer ?= {
					is_landed = yes
					highest_held_title_tier > tier_barony
					NOT = {
						any_held_title = {
							tier = tier_county
							any_county_province = {
								geographical_region = ghw_region_near_east
							}
						}
					}
				}
			}
			employer = {
				trigger_event = sicily.0071
			}
		}

		# Failsafe for edge cases
		else = {
			trigger_event = {
				id = sicily.0070
				years = { 3 10 }
			}
		}

	}
}

# Abu Aaron says he'll be leaving
sicily.0071 = {
	type = character_event
	title = sicily.0071.t
	desc = {
		desc = sicily.0071.desc
		triggered_desc = {
			trigger = {
				root = character:163094
				has_relation_friend = scope:abu_aaron
			}
			desc = sicily.0071.desc.sawdan
		}
	}
	theme = travel_pilgrimage
	override_background = { reference = RICE_background_sicily_coastal_town }
	
	left_portrait = {
		character = root
		animation = sadness
	}
	
	right_portrait = {
		character = scope:abu_aaron
		animation = personality_forgiving
	}

	immediate = {
		save_scope_as = abu_aaron_original_liege
		character:RICE_sicily_jewish_001 = {
			save_scope_as = abu_aaron
		}
		title:c_baghdad.holder = {
			save_scope_as = baghdad_holder
		}
		set_global_variable = {
			name = RICE_sicily_abu_aaron_event_happened
			value = yes
		}
	}
	
	option = { # Let him go
		name = sicily.0071.a
		add_piety = major_piety_gain
		scope:abu_aaron = {
			set_employer = scope:baghdad_holder
			start_travel_plan = {
				destination = scope:baghdad_holder.capital_province
				return_trip = no # One way
			}
		}
		scope:baghdad_holder = {
			trigger_event = sicily.0072
		}
	}


	option = { # Try to detain him
		name = sicily.0071.b
		add_prestige = major_prestige_loss
		# scope:abu_aaron = {
		# 	if = {
		# 		limit = { has_relation_friend = root }
		# 		remove_friend_or_downgrade_friendship_effect = { SCOPE = root }
		# 	}
		# 	else_if = {
		# 		limit = { has_relation_lover = root }
		# 		remove_relation_lover = root
		# 	}
		# }
		duel = {
			skills = { prowess intrigue diplomacy }
			target = scope:courtier_1
			# You fail to detain him
			10 = {
				desc = sicily.0071.b.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.9
					min = -49
					max = 49
				}
				send_interface_toast = {
					type = event_toast_effect_bad
					left_icon = scope:abu_aaron
					title = sicily.0071.b.failure
					scope:abu_aaron = {
						set_employer = scope:baghdad_holder
						add_opinion = {
							modifier = disappointed_opinion
							target = root
							opinion = -40
						}
						start_travel_plan = {
							destination = scope:baghdad_holder.capital_province
							return_trip = no # One way
						}
					}
				}	
				scope:baghdad_holder = {
					trigger_event = sicily.0072
				}
			}
			# You manage to detain him
			10 = {
				desc = sicily.0071.b.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0.9
					min = -49
					max = 49
				}
				send_interface_toast = {
					type = event_toast_effect_good
					left_icon = scope:abu_aaron
					title = sicily.0071.b.success
					scope:abu_aaron = {
						add_trait = depressed_1
						add_opinion = {
							modifier = angry_opinion
							target = root
							opinion = -40
						}
					}
					imprison = {
						target = scope:abu_aaron
						type = house_arrest
					}
				}
			}
		}
	}

	
}


# Abu Aaron returns home
sicily.0072 = {
	type = character_event
	title = sicily.0072.t
	desc = sicily.0072.desc
	theme = diplomacy
	
	right_portrait = {
		character = scope:abu_aaron
		animation = throne_room_bow_1
	}

	lower_center_portrait = scope:abu_aaron_original_liege

	immediate = {
		# Make sure you can't convert Abu Aaron
		hidden_effect = {
			scope:abu_aaron = {
				trigger_event = RICEmisc.0002
			}
		}
		show_as_tooltip = {
			scope:abu_aaron = {
				set_employer = scope:baghdad_holder
			}			
		}
	}
	
	option = { # Ok
		name = sicily.0072.a
	}
}


######################################################################################
# 
# BATHS OF BAIA
# 
# sicily.0090-sicily.0099
# 
######################################################################################

# Setup activity
sicily.0090 = {
	type = character_event
	title = sicily.0090.t
	desc = sicily.0090.desc
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = personality_content
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_hot_springs_visit
			activity_location.barony = title:b_napoli
		}
	}
	
	option = { # Ok
		name = sicily.0090.a
		if = {
			limit = {
				faith = {
					NOT = { trait_is_virtue = chaste }
					OR = {
						faith = { has_doctrine = tenet_hedonistic }
						faith = { has_doctrine = tenet_carnal_exaltation }
						trait_is_virtue = lustful
					}
				}
			}
			custom_tooltip = RICE_sicily_baia_modifier.travel.dont_care
		}
		else_if = {
			limit = {			
				OR = {
					AND = {
						faith = { has_doctrine_parameter = male_dominated_law }
						is_female = yes
					}
					AND = {
						faith = { has_doctrine_parameter = female_dominated_law }
						is_male = yes
					}
				}
			}
			custom_tooltip = RICE_sicily_baia_modifier.travel.non_dominant
		}
		else = {
			custom_tooltip = RICE_sicily_baia_modifier.travel.dominant
		}
	}	
}


# Day of the Springs visit
sicily.0091 = {
	type = activity_event
	title = sicily.0091.t
	desc = sicily.0091.desc
	theme = RICE_theme_sicily_amalfi_coast
	
	right_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		add_character_flag = is_naked
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_hot_springs_visit_type_public
					}
				}
			}
			set_variable = {
				name = RICE_hot_springs_visit_special_type
				value = flag:public
				days = 1
			}
		}
		else = {			
			set_variable = {
				name = RICE_hot_springs_visit_special_type
				value = flag:private
				days = 1
			}
		}
	}
	
	option = { # Relaxing
		name = sicily.0091.a
		stress_impact = {
			base = miniscule_stress_impact_loss
		}
	}
	
	option = { # Beaches
		name = sicily.0091.b
		add_prestige = miniscule_prestige_gain
	}
	
	option = { # Sightseeing
		name = sicily.0091.c
		RICE_minor_lifestyle_experience_gain_effect = yes
	}
	
	after = {
		RICE_sicily_visit_baia_effect = yes
		if = {
			limit = { has_character_flag = is_naked }
			remove_character_flag = is_naked
		}
		# RICE_hot_springs_memory_effect = yes
		set_variable = {
			name = RICE_hot_springs_visit_special_location
			value = flag:baia
			days = 1
		}
		scope:activity = {
			every_attending_character = {
				limit = { NOT = { this = scope:host } }
				custom = EVERY_ACTIVITY_PARTICIPANT_EFFECT
				stress_impact = {
					base = minor_stress_impact_loss
				}
				# random_list = {
				# 	desc = RICE_sicily_baia_enjoy_yourself_tt
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.dominant
				# 		trigger = {
				# 			NOT = {
				# 				faith = {
				# 					NOT = { trait_is_virtue = chaste }
				# 					OR = {
				# 						faith = { has_doctrine = tenet_hedonistic }
				# 						faith = { has_doctrine = tenet_carnal_exaltation }
				# 						trait_is_virtue = lustful
				# 					}
				# 				}
				# 			}
				# 			NOR = {
				# 				AND = {
				# 					faith = { has_doctrine_parameter = male_dominated_law }
				# 					is_female = yes
				# 				}
				# 				AND = {
				# 					faith = { has_doctrine_parameter = female_dominated_law }
				# 					is_male = yes
				# 				}
				# 			}						
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_normal
				# 			years = 10
				# 		}
				# 	}
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.non_dominant
				# 		trigger = {
				# 			NOT = {
				# 				faith = {
				# 					NOT = { trait_is_virtue = chaste }
				# 					OR = {
				# 						faith = { has_doctrine = tenet_hedonistic }
				# 						faith = { has_doctrine = tenet_carnal_exaltation }
				# 						trait_is_virtue = lustful
				# 					}
				# 				}
				# 			}
				# 			OR = {
				# 				AND = {
				# 					faith = { has_doctrine_parameter = male_dominated_law }
				# 					is_female = yes
				# 				}
				# 				AND = {
				# 					faith = { has_doctrine_parameter = female_dominated_law }
				# 					is_male = yes
				# 				}
				# 			}						
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_naughty
				# 			years = 10
				# 		}
				# 	}
				# 	# You're a faith that doesn't care about such things
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.dont_care
				# 		trigger = {
				# 			faith = {
				# 				NOT = { trait_is_virtue = chaste }
				# 				OR = {
				# 					faith = { has_doctrine = tenet_hedonistic }
				# 					faith = { has_doctrine = tenet_carnal_exaltation }
				# 					trait_is_virtue = lustful
				# 				}
				# 			}					
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_naughty
				# 			years = 10
				# 		}
				# 	}
				# }
				# if = {
				# 	limit = {
				# 		OR = {
				# 			AND = {
				# 				faith = { has_doctrine_parameter = male_dominated_law }
				# 				is_female = yes
				# 			}
				# 			AND = {
				# 				faith = { has_doctrine_parameter = female_dominated_law }
				# 				is_male = yes
				# 			}
				# 		}
				# 	}
				# 	add_character_modifier = {
				# 		modifier = RICE_sicily_visit_baia_naughty
				# 		years = 10
				# 	}
				# }
				# else = {
				# 	add_character_modifier = {
				# 		modifier = RICE_sicily_visit_baia_normal
				# 		years = 10
				# 	}
				# }
			}	
			hidden_effect = { skip_activity_phase = yes }
		}
	}	
}






######################################################################################
# 
# ADMINISTER FRONTIER DECISION
# 
# sicily.0100-sicily.0119
# 
######################################################################################


# Promote Officials
sicily.0100 = {
	type = character_event
	title = sicily.0100.t
	desc = sicily.0100.desc
	theme = stewardship_duty_focus
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Latin
		name = sicily.0100.a
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:latin
			days = 1
		}
	}
	
	option = { # Greek
		name = sicily.0100.b
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:greek
			days = 1
		}
	}
	
	option = { # Arab-Berber
		name = sicily.0100.c
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:arabic
			days = 1
		}
	}
	
	option = { # Self
		name = sicily.0100.d
		trigger = {
			NOR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}
		}
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:none
			days = 1
		}
	}

	after = {
		trigger_event = sicily.0101
	}
	
}


# Promote Officials
sicily.0101 = {
	type = character_event
	title = sicily.0101.t
	desc = sicily.0101.desc
	theme = stewardship_duty_focus
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Option 1
		name = sicily.0100.a
	}
	
	option = { # Option 2
		name = sicily.0100.b
	}
	
	option = { # No
		name = sicily.0100.c
	}

	after = {
		if = {
			limit = {
				has_variable = RICE_sicily_promote_officials_type
			}
			remove_variable = RICE_sicily_promote_officials_type
		}
	}
	
}



# Updating Bureaucratic Records
sicily.0103 = {
	type = character_event
	title = sicily.0103.t
	desc = sicily.0103.desc
	theme = stewardship_domain_focus
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:steward
		animation = writing
	}
	
	right_portrait = {
		character = root
		animation = thinking
	}
	
	option = { # Latin
		name = sicily.0103.a
	}
	
}

# Reforming government practices
sicily.0104 = {
	type = character_event
	title = sicily.0104.t
	desc = {
		desc = sicily.0104.desc
		# Latin practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:latin_ruler
				}
				desc = sicily.0104.desc.latin
			}
			desc = sicily.0104.desc.no_latin # Fallback option
		}
		# Greek practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:greek_ruler
				}
				desc = sicily.0104.desc.greek
			}
			desc = sicily.0104.desc.no_greek # Fallback option
		}
		# Arabic practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:arabic_ruler
				}
				desc = sicily.0104.desc.arabic
			}
			desc = sicily.0104.desc.no_arabic # Fallback option
		}
	}
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:councillor
		animation = happy_teacher
	}
	
	right_portrait = {
		character = root
		animation = thinking
	}

	lower_left_portrait = {
		trigger = { exists = scope:latin_ruler }
		character = scope:latin_ruler
	}
	lower_center_portrait = {
		trigger = { exists = scope:greek_ruler }
		character = scope:greek_ruler
	}
	lower_right_portrait = {
		trigger = { exists = scope:arabic_ruler }
		character = scope:arabic_ruler
	}

	immediate = {

		# Choose the councilor to talk to you
		if = {
			limit = {
				exists = cp:councillor_chancellor
			}
			cp:councillor_chancellor = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_steward
			}
			cp:councillor_steward = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
			}
			cp:councillor_court_chaplain = {
				add_to_list = councilor_candidates
			}
		}
		random_in_list = {
			list = councilor_candidates
			save_scope_as = councillor
		}

		# Possible ruler chosen to use as a basis
		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_latin_trigger = yes
					holder = {
						RICE_sicily_latin_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_latin_trigger = yes
					holder = {
						RICE_sicily_latin_trigger = yes
					}
				}
				add_to_list = nearby_latin_counties
			}
			random_in_list = {
				list = nearby_latin_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = latin_county
			}
			scope:latin_county.holder = {
				save_scope_as = latin_ruler
			}
		}

		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_greek_trigger = yes
					holder = {
						RICE_sicily_greek_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_greek_trigger = yes
					holder = {
						RICE_sicily_greek_trigger = yes
					}
				}
				add_to_list = nearby_greek_counties
			}
			random_in_list = {
				list = nearby_greek_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = greek_county
			}
			scope:greek_county.holder = {
				save_scope_as = greek_ruler
			}
		}

		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_arabic_trigger = yes
					holder = {
						RICE_sicily_arabic_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_arabic_trigger = yes
					holder = {
						RICE_sicily_arabic_trigger = yes
					}
				}
				add_to_list = nearby_arabic_counties
			}
			random_in_list = {
				list = nearby_arabic_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = arabic_county
			}
			scope:arabic_county.holder = {
				save_scope_as = arabic_ruler
			}
		}		
	}
	
	option = { # Latin
		name = sicily.0104.a
		RICE_sicily_signore_latin_track_major_gain = yes
		scope:latin_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:latin_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:latin_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:latin_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:latin_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:latin_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:latin_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}

	option = { # Greek
		name = sicily.0104.b
		RICE_sicily_signore_greek_track_major_gain = yes
		scope:greek_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:greek_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:greek_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:greek_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:greek_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:greek_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:greek_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}	

	option = { # arabic
		name = sicily.0104.c
		RICE_sicily_signore_arabic_track_major_gain = yes
		scope:arabic_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:arabic_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:arabic_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:arabic_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:arabic_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:arabic_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:arabic_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}

	after = {
		RICE_sicily_government_practices_effect = yes
	}

}




# Caricatori Ports
sicily.0108 = {
	type = character_event
	title = sicily.0108.t
	desc = sicily.0108.desc
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_sicily_coastal_town }
	
	right_portrait = {
		character = root
		animation = steward
	}

	immediate = {
		RICE_sicily_agenda_port_effect = yes
		# Possible ruler chosen to improve relations
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_latin_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_latin_trigger = yes
		# 		}
		# 		add_to_list = nearby_latin_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_latin_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = latin_county
		# 	}
		# 	scope:latin_county.holder = {
		# 		save_scope_as = latin_ruler
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_greek_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_greek_trigger = yes
		# 		}
		# 		add_to_list = nearby_greek_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_greek_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = greek_county
		# 	}
		# 	scope:greek_county.holder = {
		# 		save_scope_as = greek_ruler
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_arabic_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_arabic_trigger = yes
		# 		}
		# 		add_to_list = nearby_arabic_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_arabic_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = arabic_county
		# 	}
		# 	scope:arabic_county.holder = {
		# 		save_scope_as = arabic_ruler
		# 	}
		# }
	}
	
	option = { # Latin
		name = sicily.0108.a
		RICE_sicily_signore_latin_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_latin
			years = 15
		}
	}
	
	option = { # Greek
		name = sicily.0108.b
		RICE_sicily_signore_greek_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_greek
			years = 15
		}
	}
	
	option = { # Arab-Berber
		name = sicily.0108.c
		RICE_sicily_signore_arabic_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_arabic
			years = 15
		}
	}
	
}






######################################################################################
# 
# VIRGIL FLAVOR
# 
# sicily.0120-sicily.0129
# 
######################################################################################

# Setup activity
sicily.0120 = {
	type = character_event
	title = sicily.0120.t
	desc = sicily.0120.desc
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_sicily_virgil_tomb_visit
		}
	}

	immediate = {		
		culture:roman = {
			save_scope_as = roman
		}
	}
	
	option = { # Ok
		name = sicily.0120.a
	}	
}


# Day of the visit to the tunnel
sicily.0121 = {
	type = activity_event
	title = sicily.0121.t
	desc = sicily.0121.desc
	theme = RICE_theme_sicily_virgils_tomb
	
	right_portrait = {
		character = root
		animation = personality_content
	}

	immediate = {			
		culture:roman = {
			save_scope_as = roman
		}
	}
	
	option = { # Relaxing
		name = sicily.0121.a
	}
	
	after = {
		trigger_event = {
			id = sicily.0122
			days = { 2 5 }
		}
	}	
}

# Go to the chapel / reflect on Virgil
sicily.0122 = {
	type = activity_event
	title = sicily.0122.t
	desc = sicily.0122.desc
	theme = RICE_theme_sicily_virgils_tomb
	
	right_portrait = {
		character = root
		animation = thinking
	}
	
	option = { # Relaxing
		name = sicily.0122.a
		RICE_sicily_virgil_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}




######################################################################################
# 
# PALERMO TOMB VISIT
# 
# sicily.0130-sicily.0139
# 
######################################################################################

# Setup activity
sicily.0130 = {
	type = character_event
	title = sicily.0130.t
	desc = {
		desc = sicily.0130.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					involved_activity ?= {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_aristotle
						}
					}
				}
				desc = sicily.0130.desc.aristotle
			}
			triggered_desc = {
				trigger = {
					involved_activity ?= {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_galen
						}
					}
				}
				desc = sicily.0130.desc.galen
			}
		}
		desc = sicily.0130.desc
	}
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_sicily_palermo_tomb_visit
		}
	}

	immediate = {		
		culture:greek = {
			save_scope_as = greek
		}
		title:c_palermo = {
			faith = {
				save_scope_as = palermo_faith
			}
		}
	}
	
	option = { # Ok
		name = sicily.0130.a
	}	
}


# Arrive in Palermo, looking for the tomb
sicily.0131 = {
	type = activity_event
	title = sicily.0131.t
	desc = {
		desc = sicily.0131.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_aristotle
						}
					}
				}
				desc = sicily.0131.desc.aristotle
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_galen
						}
					}
				}
				desc = sicily.0131.desc.galen
			}
		}
	}
	theme = RICE_theme_sicily_village
	
	right_portrait = {
		character = root
		animation = personality_greedy
	}

	immediate = {			
		culture:greek = {
			save_scope_as = greek
		}
		title:c_palermo = {
			faith = {
				save_scope_as = palermo_faith
			}
		}
	}
	
	option = { # Relaxing
		name = sicily.0131.a
	}
	
	after = {
		if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_sicily_palermo_tomb_visit_aristotle
					}
				}
			}
			trigger_event = {
				id = sicily.0132
				days = { 2 5 }
			}
		}
		else_if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_sicily_palermo_tomb_visit_galen
					}
				}
			}
			trigger_event = {
				id = sicily.0133
				days = { 2 5 }
			}
		}
	}	
}

# Go to Aristotle's coffin/tomb
sicily.0132 = {
	type = activity_event
	title = sicily.0132.t
	desc = sicily.0132.desc
	theme = faith
	override_icon = "gfx/interface/icons/event_types/type_learning.dds"
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # ok
		name = sicily.0132.a
		RICE_sicily_palermo_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}

# Go to Galen's tomb
sicily.0133 = {
	type = activity_event
	title = sicily.0133.t
	desc = sicily.0133.desc
	theme = RICE_theme_sicily_ancient_temple
	override_icon = "gfx/interface/icons/event_types/type_medicine.dds"
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # ok
		name = sicily.0133.a
		RICE_sicily_palermo_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}









